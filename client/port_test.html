<!DOCTYPE html>
<html ng-app="myApp" ng-controller='myCtrl'>
<head>
	<title>ktl接口测试</title>
	<style type="text/css">
		* {
			box-sizing: border-box;
		}
		body {
			background: #8d9d94;
			height: 2000px;
		}
		ul {
			padding: 0;
	    	margin: 0;
	    	font-size: 13px;
	    	list-style: none;
	    	border: 1px solid #717272;
	    	border-radius: 4px;
	    	cursor: pointer;
	    	background: rgba(0,0,0,0.7);
	    	color: white;
		}
		ul li {
			position: relative;
			padding: 6px;
		}
		ul li:hover {
			background: #7c7373;
		}
		ul li:hover>ul {
			display: block;
		}
		.ps-r {
			position: relative;
		}
		.label-url {
	        vertical-align: middle;
	        color: #585858;
	        margin-right: 30px;
	        height: 38px;
	        display: inline-block;
	        line-height: 38px;
	        /* padding-left: 40px; */
	        text-align: center;
	        border: 1px solid #405d76;
	        font-size: 13px;
	        border-radius: 4px;
	    }
	    .width-400 {
	    	width: 400px;
	    }
	    .width-300 {
	    	width: 300px;
	    }
	    .width-200 {
	    	width: 200px;
	    }
	    .icon {
	    	position: absolute;
	    	top: 9px;
	    	right: 12px;
	    }
	    .oneview {
	    	position: absolute;
	    	width: 100%;
	    	top: 37px;
	    	left: 0;
	    	text-align: center;
	    }
	    .child-ul {
	    	position: absolute;
	    	display: none;
	    	width: 400px;
	    	top: 0;
	    	right: -400px;
	    }
	    .cursor-pointer {
	    	cursor: pointer;
	    }
	</style>

	<link href="//netdna.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
	<script src="https://cdn.bootcss.com/angular.js/1.2.0/angular.js"></script>
</head>
<body>
<div style="width:800px;margin:0 auto;">
	<h3>接口url</h3>
	<div>
		<lable>前缀</lable><input type="text" class="label-url width-300" ng-model="portUrl_start">
		<lable>后缀</lable>
		<div class="ps-r" style="width:200px;display:inline-block" ng-init='model.isShow=false'>
			<input type="text" ng-model='model.url' class="label-url width-200 cursor-pointer" placeholder="请选择接口" ng-click="showlist();model.isShow=!model.isShow" name="">
			<i class="fa fa-sort-down icon"></i>
			<ul class="oneview" ng-show="model.isShow">
				<li ng-repeat="list in model.urlList">
					{{list.title}}
					<ul class="child-ul">
						<li ng-repeat="item in list.data" ng-click="getDetail(item.pointer_url);model.isShow=false;model.url=item.url">{{item.name+' '+item.url}}</li>
					</ul>
				</li>
			</ul>
		</div>
	</div>
	<h3>参数配置</h3>
	<form id='dataform'>
		<div style="margin-top: 12px;" ng-repeat="dtl in model.detail">
			<label>参数名</label><input type="text" ng-model='dtl.field' class="label-url" name="{{dtl.field}}">
			<label>参数值</label><input type="text" ng-model="dtl[dtl.field+'_'+'data']" class="label-url width-400" name="{{dtl.field+'_'+'data'}}">
		</div>
	</form>
	
	<div style="text-align:left;margin-top: 30px;">
		<button ng-click="getDetailData()">请求数据</button>
	</div>
	<div style="margin-top: 20px;">
		<pre>{{model.rows}}</pre>
	</div>
</div>
	
	<script type="text/javascript">
		angular.module('myApp', [])
        .controller('myCtrl', ['$scope', '$http', function($scope, $http) {
        	$scope.portUrl_start = "http://192.168.10.133:8080/ktl/";
        	$scope.portUrl_end = "resource/getSourceData";
        	$scope.model = {
        		isShow:false,
        		urlList:[],
        		detail:{},
        		url:'',
        		rows:''
        	}

        	$http({
    			method:'get',
    			url:'/getData',
    			params:{}
    		}).success(function(_d){
    			if(_d.success){
    				$scope.model.urlList=_d.result;
    			}
    		})

        	$scope.getDetail=function(pointer_url){
        		$http({
        			method:'get',
        			url:'/getDetail',
        			params:{pointer_url:pointer_url}
        		}).success(function(_d){
        			if(_d.success){
        				$scope.model.detail=_d.result;
        			}
        		})
        	};

        	$scope.getDetailData = function(){
        		var params = {};
        		params.pointer_url=$scope.model.url;
        		$scope.model.detail.forEach(function(item){
        			console.log(item);
        			params[item.field]=item[item.field+'_'+'data'];
        		})
        		$http({
        			method:'get',
        			url:'/getDetailData',
        			params:params
        		}).success(function(_d){
        			if(_d.success){
        				$scope.model.rows=_d.result;
        			}
        		})
        	}
        }])
	</script>
</body>
</html>